\ProvidesPackage{latex-bfs-queue}[2021/03/27 v1.0 Implementation of a queue data structure]
\RequirePackage{etoolbox,xstring}

\def\CreateQueue#1{%
    \ifcsname c@lbfsqu@ds@queue@#1\endcsname
        \PackageError{latex-bfs-queue}{The Queue '#1' does already exist.}\fi
    \expandafter\def\csname lbfsqu@ds@queue@#1\endcsname{}%
    \newcounter{lbfsqu@ds@queue@#1}%
}

\def\DeclareQueue#1{%
    \ifcsname c@lbfsqu@ds@queue@#1\endcsname\ResetQueue{#1}\else
    \CreateQueue{#1}\fi
}

\def\ResetQueue#1{%
    \expandafter\def\csname lbfsqu@ds@queue@#1\endcsname{}%
    \csname c@lbfsqu@ds@queue@#1\endcsname0%
}

\def\GetQueue#1{\csname lbfsqu@ds@queue@#1\endcsname}
\def\GetQueueSize#1{\arabic{lbfsqu@ds@queue@#1}}

\def\Enqueue#1#2{
    \expandafter\advance\csname c@lbfsqu@ds@queue@#1\endcsname\@ne
    \ifnum\value{lbfsqu@ds@queue@#1}=1\relax
    \expandafter\def\csname lbfsqu@ds@queue@#1\endcsname{{#2}}\else
    \csappto{lbfsqu@ds@queue@#1}{,{#2}}\fi
}

\def\eEnqueue#1#2{%
    \expandafter\advance\csname c@lbfsqu@ds@queue@#1\endcsname\@ne
    \ifnum\value{lbfsqu@ds@queue@#1}=1\relax
    \expandafter\protected@edef\csname lbfsqu@ds@queue@#1\endcsname{{#2}}\else
    \protected@cseappto{lbfsqu@ds@queue@#1}{,{#2}}\fi
}

\long\def\lbfsqu@@dq#1#2,#3\@nil{%
    \protected@edef\dequeued{#2}%
    \ifnum\value{lbfsqu@ds@queue@#1}=1\relax% fix unpack on last pack
    \expandafter\def\csname lbfsqu@ds@queue@#1\endcsname{{#3}}%
    \else\expandafter\def\csname lbfsqu@ds@queue@#1\endcsname{#3}%
    \fi
}

\def\lbfsqu@dq@last#1{%
    \protected@edef\dequeued{\csname lbfsqu@ds@queue@#1\endcsname}%
    \csname c@lbfsqu@ds@queue@#1\endcsname0%
    \expandafter\def\csname lbfsqu@ds@queue@#1\endcsname{}%
}

\def\lbfsqu@dq@normal#1{%
    \expandafter\advance\csname c@lbfsqu@ds@queue@#1\endcsname-1\relax
    \protected@edef\@tmp{\noexpand\lbfsqu@@dq{\unexpanded{#1}}\csname lbfsqu@ds@queue@#1\endcsname\noexpand\@nil}%
    \@tmp
}

\def\Dequeue#1{%
\ifnum\value{lbfsqu@ds@queue@#1}<2\relax
\lbfsqu@dq@last{#1}\else\lbfsqu@dq@normal{#1}\fi
}

\def\GlobalQueue#1{%
    \expandafter\xdef\csname lbfsqu@ds@queue@#1\endcsname{\csexpandonce{lbfsqu@ds@queue@#1}}%
    \setcounter{lbfsqu@ds@queue@#1}{\value{lbfsqu@ds@queue@#1}}%
}

\newif\if@lbfsqu@inq@
% TODO: maybe make more efficient?
% if #2 in #1 do #3; else #4
\def\IfInQueue#1#2#3#4{\@lbfsqu@inq@false
\def\do##1{\IfStrEq{##1}{#2}{\@lbfsqu@inq@true\listbreak}{}}%
\edef\@tmp{\noexpand\docsvlist{\csexpandonce{lbfsqu@ds@queue@#1}}}\@tmp%
\if@lbfsqu@inq@#3\else#4\fi
}

\def\AppendQueue#1#2{%
\ifnum\value{lbfsqu@ds@queue@#1}=0\relax \expandafter\protected@edef\csname lbfsqu@ds@queue@#1\endcsname{\csname lbfsqu@ds@queue@#2\endcsname}\else
\protected@cseappto{lbfsqu@ds@queue@#1}{,\csname lbfsqu@ds@queue@#2\endcsname}\fi
\expandafter\advance\csname c@lbfsqu@ds@queue@#1\endcsname\value{lbfsqu@ds@queue@#2}%
}
\endinput